#! /bin/bash
# -----------------------------------------------------------------------------------------------------------
# Tuxbox Build & Compiler Helper
# Plugin: ybuild diagnostic
#
# Started by yjogol (yjogol@online.de)
# $Date: 2008/12/23 08:32:41 $
# $Revision: 1.1 $
# -----------------------------------------------------------------------------------------------------------

# -----------------------------------------------------------------------------------------------------------
# INIT
# -----------------------------------------------------------------------------------------------------------

yb_log_fileversion "\$Revision: 1.1 $ \$Date: 2008/12/23 08:32:41 $ _yb_diagnostic.plugin.sh"
yb_plugin_add "ybuild_diagnostic" "_yb_diagnostic.plugin.sh" "yb_plugin_diagnostic"
LOGDIAGFILE=$SCRIPTDIR/diag.log

# -----------------------------------------------------------------------------------------------------------
# Menu
# -----------------------------------------------------------------------------------------------------------
yb_plugin_diagnostic_menu()
{
	[ "$SDEBUG" != "0" ] && echo "DEBUG: Enter for next Menu" && read dummy

	dialog --backtitle "$prgtitle" --title " Hello world "\
		--cancel-label "$l_back"\
		--ok-label "$l_choose"\
		--menu "$l_use_arrow_keys_and_enter" 14 66 9\
		0 "start test"\
		l "view test log"\
		"" ""\
		z "$l_back" 2>$_temp
}

# -----------------------------------------------------------------------------------------------------------
# Menu Loop
# -----------------------------------------------------------------------------------------------------------
yb_plugin_diagnostic()
{
	yb_plugin_diagnostic_doquit=false
	while [ "$yb_plugin_diagnostic_doquit" == "false" ]
	do
		yb_plugin_diagnostic_menu
		opt=${?}
		if [ $opt == 0 ]; then
			cmd=`cat $_temp`
			case "$cmd" in
				0)	yb_plugin_diagnostic_doall ;;
				l)	dialog --backtitle "$prgtitle" --title " view test log " --textbox "$LOGDIAGFILE" 30 80 ;;
				z)	yb_plugin_diagnostic_doquit="true"	;;
			esac
		else
			yb_plugin_diagnostic_doquit=true
		fi
	done
}

# -----------------------------------------------------------------------------------------------------------
yb_plugin_diagnostic_doall()
{
	_yb_plugin_diagnostic_doall  $* | tee $LOGDIAGFILE
}
_yb_plugin_diagnostic_doall()
{
	echo "==========================================================================================================="
	t=`date`
	echo "  ybuild diagnostics (\$Revision: 1.1 $)  $t"
	echo "==========================================================================================================="
	echo ""
	echo "==========================================================================================================="
	echo "  OS & configuration Information"
	echo "==========================================================================================================="
	uname -a
	echo ""
	echo "==========================================================================================================="
	echo "  SHELL"
	echo "==========================================================================================================="
	t=`ls -l /bin/sh`
	echo "shell (link to shell): $t"
	t=`/bin/sh --version`
	echo "shell (version): $t"
	echo ""
	echo "-----------------------------------------------------------------------------------------------------------"
	t=`/bin/sh -c help`
	echo "shell (build-in commands): $t"
	echo ""

	echo "==========================================================================================================="
	echo "  prequisite"
	echo "==========================================================================================================="
	t=`dialog --version`
	echo "dialog version: $t"
	t=`$CVSDIR/hostapps/toolchecker/toolchecker.sh`
	echo "toolchecker: $t"
	echo ""

	echo "==========================================================================================================="
	echo "  ybuild configuration"
	echo "==========================================================================================================="
	echo "-----------------------------------------------------------------------------------------------------------"
	echo "directories:"
	echo "-----------------------------------------------------------------------------------------------------------"
	show_variables
	echo ""
	echo "-----------------------------------------------------------------------------------------------------------"
	echo "configfile:"
	echo "-----------------------------------------------------------------------------------------------------------"
	cat $yb_configfile
	echo ""
	echo "-----------------------------------------------------------------------------------------------------------"
	echo "ybuild version:"
	echo "-----------------------------------------------------------------------------------------------------------"
	echo -e "$FILEVERSIONLOG"
	echo ""
	
	echo "==========================================================================================================="
	echo "  private configuration"
	echo "==========================================================================================================="
	echo "-----------------------------------------------------------------------------------------------------------"
	echo "your customizing dir:"
	echo "-----------------------------------------------------------------------------------------------------------"
	ls -l $MyLOCALSDIR
	echo ""
	echo "-----------------------------------------------------------------------------------------------------------"
	echo "your customizing files in CDK:"
	echo "-----------------------------------------------------------------------------------------------------------"
	ls -l $CVSDIR/cdk/*local.sh
	echo ""
	echo "All informationen are saved in $LOGDIAGFILE"
	echo "$l_ready_press_enter"
	read dummy
	
}

